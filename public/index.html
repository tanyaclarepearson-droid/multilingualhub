<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Multilingual Learning Hub — Crane Nav (v2+)</title>

  <!-- Preload background for faster first paint -->
<link rel="preload" as="image" href="/images/hub-background.png" />

  <!-- CSS -->
  <link rel="stylesheet" href="/css/styles.css" />

  <!-- GSAP + Plugins -->
  <script defer src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
  <script defer src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/MotionPathPlugin.min.js"></script>

  <!-- Local JS -->
  <script defer src="/js/app.js"></script>
  <script defer src="/js/modules/music.js"></script>
  <script defer src="/js/modules/pennants.js"></script>
</head>
<body>
  <button id="toggle-cranes">Toggle Cranes</button>
  <main id="stage" class="stage" aria-label="Multilingual Learning Hub">
    <!-- Background -->
    <div class="room-bg" role="img" aria-label="Hub room background"></div>

    <!-- Hotspots -->
    <div id="hotspotLayer" role="group" aria-label="Interactive areas"></div>
<!-- Decorative overlays (images), clicks handled by hotspot buttons -->
<div class="overlay-layer" aria-hidden="true">
  <img class="ov ov-jukebox"         src="/images/jukebox.png"           alt="" loading="lazy" />
  <img class="ov ov-megaphone"       src="/images/megaphone.png"         alt="" loading="lazy" />
  <img class="ov ov-green-screen"    src="/images/green-screen.png"      alt="" loading="lazy" />
  <img class="ov ov-recording-desk"  src="/images/recording-desk.png"    alt="" loading="lazy" />
  <img class="ov ov-origami"         src="/images/origami-cranes.png"    alt="" loading="lazy" />
  <img class="ov ov-papel"           src="/images/papel-picado.png"      alt="" loading="lazy" />
  <img class="ov ov-toolkit"         src="/images/toolkit-chest.png"     alt="" loading="lazy" />
  <img class="ov ov-objectives"      src="/images/objectives-screen.png" alt="" loading="lazy" />
  <img class="ov ov-elpac"           src="/images/elpac-goals.png"       alt="" loading="lazy" />
  <img class="ov ov-elevation"       src="/images/elevation-laptop.png"  alt="" loading="lazy" />
  <img class="ov ov-delac"           src="/images/delac-marquee.png"     alt="" loading="lazy" />
  <img class="ov ov-avid-tk2"        src="/images/avid-tk-2.png"         alt="" loading="lazy" />
  <img class="ov ov-avid-35"         src="/images/avid-3-5.png"          alt="" loading="lazy" />
  <img class="ov ov-avid-68"         src="/images/avid-6-8.png"          alt="" loading="lazy" />
  <img class="ov ov-avid-912"        src="/images/avid-9-12.png"         alt="" loading="lazy" />
  <img class="ov ov-flower"          src="/images/flower-vase.png"       alt="" loading="lazy" />
  <img class="ov ov-songbridge"      src="/images/songbridge.png"        alt="" loading="lazy" />
</div>

    <a class="skip" href="#dock">Skip to category dock</a>

    <!-- Zones -->
    <div id="zone-frameworks" class="zone">Frameworks</div>
    <div id="zone-tools" class="zone">Tools</div>
    <div id="zone-newcomers" class="zone">Newcomers</div>
    <div id="zone-avid" class="zone">AVID</div>
    <div id="zone-ellevation" class="zone">Ellevation</div>
    <div id="zone-multicultural" class="zone">Multicultural</div>
    <div id="zone-calls" class="zone">Calls to Action</div>
    <div id="zone-assessment" class="zone">Assessment</div>
    <div id="zone-music" class="zone">Music</div>
    <div id="zone-creative" class="zone">Creative</div>

    <svg id="paths" class="paths" aria-hidden="true"></svg>
    <nav id="dock" class="dock" aria-label="Category navigation"></nav>

    <!-- Welcome Section -->
    <section id="welcome" class="welcome" role="dialog" aria-modal="true" aria-labelledby="wTitle" aria-describedby="wBody">
      <div class="card">
        <h1 id="wTitle">Welcome to the Multilingual Learning Hub</h1>
        <div id="wBody" class="wbody">
          <p><strong>Intent:</strong> A living hub for resources, pathways, and calls to action to strengthen multilingual learning across NUSD.</p>
          <ol>
            <li>Skim the color-coded cranes (categories) below.</li>
            <li>Click one → it flies to its resource zone and opens an info card.</li>
            <li>After first visit, cranes anchor near their zones for quick re-access.</li>
          </ol>
          <div class="actions">
            <button id="startExploring" class="btn primary">Start exploring</button>
            <button id="skipOnce" class="btn ghost">Skip once</button>
          </div>
        </div>
      </div>
    </section>

    <!-- Modal -->
    <section id="modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="mTitle" aria-describedby="mBody" hidden>
      <header id="mTitle"></header>
      <div id="mBody"></div>
      <div class="actions">
        <a id="mLink" class="btn primary" target="_blank" rel="noopener">Open</a>
        <button id="mClose" class="btn ghost">Close</button>
      </div>
    </section>
  </main>

  <!-- Music Player -->
  <div id="musicPlayer" class="music-player hidden" role="region" aria-label="Music player">
    <div class="mp-head">
      <strong>Jukebox</strong>
      <button class="mp-close" aria-label="Close player">×</button>
    </div>
    <div class="mp-body">
      <button class="mp-prev" aria-label="Previous track">⟨</button>
      <button class="mp-play" aria-label="Play/Pause">▶</button>
      <button class="mp-next" aria-label="Next track">⟩</button>
      <span class="mp-title" aria-live="polite">Track</span>
    </div>
    <audio id="mp-audio" preload="none"></audio>
  </div>

  <!-- Pennants Panel -->
  <div id="pennantsPanel" class="pennants-panel hidden" role="region" aria-label="AVID Pennants">
    <div class="pp-head">
      <strong>AVID Emerge — Grade Bands</strong>
      <button class="pp-close" aria-label="Close panel">×</button>
    </div>
    <div class="pp-body">
      <button data-grade="TK-2" class="pp-pill">TK–2</button>
      <button data-grade="3-5"  class="pp-pill">3–5</button>
      <button data-grade="6-8"  class="pp-pill">6–8</button>
      <button data-grade="9-12" class="pp-pill">9–12</button>
    </div>
    <div class="pp-links"></div>
  </div>

  <!-- Hotspots Script -->
  <script>
    (async function () {
      const params = new URLSearchParams(location.search);
      if (params.get('dev') === '1') document.documentElement.classList.add('dev');

      const layer = document.getElementById('hotspotLayer');

      let map = [];
      try {
        const r = await fetch('/data/hotspots.json', { cache: 'no-cache' });
        if (r.ok) map = await r.json();
      } catch (e) { map = []; }

      map.forEach(h => {
        const btn = document.createElement('button');
        btn.className = 'hotspot';
        btn.type = 'button';
        btn.setAttribute('aria-label', h.label || h.id || 'Hotspot');
        btn.dataset.id = h.id || '';
        const [x,y,w,hg] = h.rect;
        Object.assign(btn.style, {
          left:(x*100)+'%', top:(y*100)+'%',
          width:(w*100)+'%', height:(hg*100)+'%'
        });

        btn.addEventListener('click', () => {
          if (h.dataOpen) {
            document.dispatchEvent(new CustomEvent('hub:open', { detail:{ target:h.dataOpen, meta:h } }));
          } else if (h.href) {
            if (h.target === '_blank') window.open(h.href, '_blank', 'noopener');
            else location.href = h.href;
          }
        });

        btn.addEventListener('keydown', (e) => {
          if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); btn.click(); }
        });

        layer.appendChild(btn);
      });

      const reduce = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
      if (!reduce && !localStorage.getItem('hubOnboardingDone')) {
        layer.querySelectorAll('.hotspot').forEach(h => h.classList.add('pulse-once'));
        setTimeout(() => {
          layer.querySelectorAll('.hotspot').forEach(h => h.classList.remove('pulse-once'));
          localStorage.setItem('hubOnboardingDone','1');
        }, 3600);
      }

      document.addEventListener('hub:open', (e) => {
        const tgt = e.detail?.target;
        if (tgt === 'music') {
          const openBtn = document.querySelector('.hotspot-music');
          openBtn?.click();
        }
        if (tgt === 'pennants') {
          const openBtn = document.querySelector('.hotspot-pennants');
          openBtn?.click();
        }
      });
    })();
  </script>
  
</body>
</html>
